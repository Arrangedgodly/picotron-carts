picotron cartridge // www.picotron.net
version 2

:: afx/
:: afx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTEyIDA2OjU4OjM5Iixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSJdXQ==
:: gfx/
:: gfx/0.gfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIwOjU1OjM5Iixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSIscmV2aXNpb249MTUxM11dbHo0AGECAADOMgAA8yF7WzBdPXtibXA9cHh1
AEMgEBAE8FYHEAfAF9AXwAcQB-BWLGZsYWdzPTAscGFuX3gIAMt5PTAsem9vbT04fSw_AP8ZAwbQ
FtAGECaQVpAWEAagBiAGMEZAZgAGYBZAFmAGQBbAFsAW0AbwJlgAHfAGFycAF2CHUEcgF1AXMCew
F9A34AfACAB-J8An4AfwFVAAHf8KFl8WgC6wHtAO4F6gToAukD6wbtA_oE7gLksAH-8jFDWwBUAl
YBUANQAFgBUwBXAVMBVwBQAFEBVwFQA1gAUgFYAVEGVAFRAVMAVgVcAF8BdiAB3xFwUvFaAuwA4w
TlAOIC4AHlAuMB5QHhAuEB5ALjAOAB5ADgAOMA4ABgCwEE4ALjAOED4ALlAcAL8OYC4gLnBekC7w
CHUAHvAPbw9wHtAeED6ADgAeEB5wDgAOIB6ALgAuUH4ADjBObQDgMA4QDiAOEB4wHgAOIA6ZAAAG
AG9wfpBe8BRvABnyDiAgBPAkDxLwDh7wDS7wDQ4QDtBecA4QDvAEDlAeBwDwEA4wDvACjiAe8AAu
IF4QDuAuIC4wPtAeIC4wTsAuAE6QAHCQLgAuAA5Q8QDwAE4gDjA_ID6gDjAOIE4AXggAkBAuAG4A
DrAOIKwAQE4gHrAcAP8mXiAewA4wPhAuMA7QTgAOAD4wLvABTjA_AA7wAg4AvvACDjA_AB7wBU4w
XvADDqAe8A8O8JPaAAsdNUkBH-AxAAsfOTEA----------------------------------------
----------------------9gUG09OX19
:: gfx/sprites.gfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTEzIDAwOjIwOjA1Iixtb2RpZmllZD0iMjAyNC0x
Mi0xMyAwMjowODo1MCIscmV2aXNpb249OV1dbHo0AMkCAADJNAAA8yF7WzBdPXtibXA9cHh1AEMg
EBAE8FYHEAfAF9AXwAcQB-BWLGZsYWdzPTAscGFuX3gIAMp5PTAsem9vbT04fSw_APEAwSABLxAB
JhEGAQ4BEAEuCgAzHgEACgBQLhEuAVYGAPYAcS4R3hHeER6RHhEeAXcBBgA-FzEXDgADL-EBigAc
8QDMIAwvHAwmHAYMDgwQDC4KADMeDAAKAFAuHC4MVgYA9gB8LhzeHN4cHpweHB4MdwwGAD8XPBcO
AAMf-IoAHfUC-yAB1h7WHtb_AQAOJgd2DhAGAIAOFg42DiAOFgkAPyYOMAkACCAeBgkARxYOUA4J
AF9WDmB_MI0AHWIXAd8YHxcEANP-FwEADi8YCH0OEA4tBgCADh0OPQ4gDh0JAD8tDjAJAAggHg0J
AEcdDlAOCQAfXZQAIPETMIVQBY8gBTAFrgUwBZ4FQGUuBTAFUAUuBSAFDgVABS4FEAwAU04VTgUg
DgAxQAUODACTUAUwBS5lQAWePgBPjgVQhX8AHvERhlAGhwYwBqcGMAaXBkBmJwYwBlAGJwYgBgcG
QAYnBhAMAFNHFkcGIA4AMUAGBwwAk1AGMAYnZkAGlz4AT4cGUIZ_AB3wETWwBS8gFZAFThVwBW4V
UAWOFTAFrhUQBc4FAAXeFd4VCAAAEAAAGAAAIAAAKABfLhWQNbBoABzwEDawBicWkAZHFnAGZxZQ
BocWMAanFhAGxwYABtcW1xYIAAAQAAAYAAAgAAAoAE8nFpA2ZwAdv-ACtSAFvyAFEAW_BAAWTyC1
8AJnAB5vtiAGtwYQBAAYLyC2ZgAfgQMlMCVABS8gdAI-MAUuCABCb0AlMCXwA5sAHjQmMCaeAh8w
CABET0AmMCaaAB8f8DEA--------------------------------------------------------
-----4lQbT04fX0=
:: gfx/ui.gfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTEzIDAyOjA4OjU4Iixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSIscmV2aXNpb249NzAwXV1sejQAqQQAAOE2AADzIXtbMF09e2JtcD1weHUA
QyAQEATwVgcQB8AX0BfABxAH8FYsZmxhZ3M9MCxwYW5feAgAynk9MCx6b29tPTZ9LD4A8QDBIAEv
EAEmEQYBDgEQAS4KADMeAQAKAFAuES4BVgYA9gBxLhHeEd4RHpEeER4BdwEGAD8XMRcOAAMv8QGK
ABzxAMwgDC8cDCYcBgwODBAMLgoAMx4MAAoAUC4cLgxWBgD2AHwuHN4c3hwenB4cHgx3DAYAPxc8
Fw4AAx-8igAd8QD-IAHWHtYe1v4BAA62DhAEAP8ANg4WDjYOIA4mDhYOJg4wCAAFMB4WDgIAJFAO
CABfdg5gfjCAAB1iFwHfGB8XBAD-Dv8XAQAOvxgOEA69DhAOPQ4dDj0OIA4tDh0OLQ4wCAAFMB4d
DgIAJFAOCAAffYcAIPESMIdQB4YHMAemBzAHlgdAZyYHMAdQByYHIAcGB0AHJgcQDABTRhdGByAO
ADFABwYMAJNQBzAHJmdAB5Y_AE_GB1CHfgAe8RGGUAaHBjAGpwYwBpcGQGYnBjAGUAYnBiAGBwZA
BicGEAwAU0cWRwYgDgAxQAYHDACTUAYwBidmQAaXPgBPhwZQhn4AHfAQN7AHJheQB0YXcAdmF1AH
hhcwB6YXEAfGBwAH1hfWFwgAABAAABgAACAAACgAXyYXkDewZwAc8BA2sAYnFpAGRxZwBmcWUAaH
FjAGpxYQBscGAAbXFtcWCAAAEAAAGAAAIAAAKABPJxaQNmcAHY-wArcgB7YHEAQAGE8gt-ACZgAe
b7YgBrcGEAQAGC8gtmYAH0QDJzAnfwIfMAgARG9AJzAn8AOaAB40JjAmmwIfMAgARE9AJjAmmgAe
-wCQNKBUEATKEAQPGbkQBA4EABM-1PABZwAh6tQQ1BAkugAkDxmpACQOBACAFA65ABQOqRAEAABj
AC8Ouf8BH4MWJkAGUAYXFggEIRYQCADiNxYABgcGAEZHJgcWpxYEACCXJhIAAhoABioAAjoAb1Am
QAbwEXwAHnMnQAdQBxYXAgUhFxAIAOI2FwAHBgcAR0YnBhemFwQAIJYnEgACGgAGKgACOgBPUCdA
B3wAHvEkPxhwThgeUB4YHigeMB4oLigeEB4oHgAeKD4oHiAeKB4oHkAeWB5gHjgecB44HmAeWB5A
FgARICIAIQAeMAARLjwAER5IAD9OcD6DABzxJDhwSB8YGFAYHhguGDAYLiguGBAYLhgAGC44Lhgg
GC4YLhhAGF4YYBg_GHAYPhhgGF4YQBYAESAiACEAGDAAESg8ACAYHkgAP0hwOIMAHP89oE8boA4r
DpAeKw6QDjsOgB47PlAOOy4LHjAeOw4ADhseIA47HgAOKx4AHjsOEA47LjseEB47HjsOMB57HkAe
aw5gHksecB4rHpBOUHsAHf86S6ALIwuQGyMLkAszC4AbMztQCzMrAxswGzMLAAsTGyALMxsACyMb
ABszCxALMyszGxAbMxszCzAbcxtAG2MLYBtDG3AbIxuQS3oAHS-w8DEA--------------------
----------------------------------------AFBtPTZ9fQ==
:: gfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIxOjAzOjIwIixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSJdXQ==
:: map/
:: map/0.map
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIwOjU1OjM5Iixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSIscmV2aXNpb249MTQ3MF1dbHo0AGgAAABYEAAA8Ah7e2JtcD11c2VyZGF0
YSgiaTE2IiwzMgMALyIwAQD--------------------78QgiKSxoaWRkZW49ZmFsc2UscGFuX3g9
MAgA0nk9MCx0aWxlX2g9MTYKABB3CgCAem9vbT0xfX0=
:: map/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIxOjAzOjIwIixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSJdXQ==
:: sfx/
:: sfx/0.sfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIwOjU1OjM5Iixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSIscmV2aXNpb249MTQ1N11dbHo0AKAAAAALCgAA-zBweHUAAygAAAQABA9A
EAIOAAGgASACoA4ADxAADfDKAQIDQA8PkAQFBgdADJAICQoLQAyQDwwPDQ8ODEAM8P8BAOv-J6oB
EAYPIBABIAEgAfAAAhACDhABIA8hIAEwD0Dwww8oD--wxg-4Cg--D4AP9w8NAfAJARAGDjAA----
--_9H-8BAKzPyA9AAA8QQP--sPD-AQD-6lD-----KQ==
:: sfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIxOjAzOjIwIixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSJdXQ==
:: vgfx/
:: vgfx/0.vgfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIwOjU3OjMwIixtb2RpZmllZD0iMjAyNC0x
Mi0xMSAyMTowMzoyMCIscmV2aXNpb249MzBdXWx6NACOAAAA0QAAALB7e3tjb2xfYT0xLAgA8Cti
PTE2LGZpbGw9NDM2OTAsbmFtZT0iIixvdXRsaW5lPS0xLHBvaW50cz17ezQwLC00MH0sey0xMCwx
CQDzDjAsNDB9fSxzaG93PXRydWUsdHlwZT0iZWFyIn0saAATOGgAEjJnAE8zNzc0ZwALFS1oAD8x
MyxmAApQciJ9fX0=
:: vgfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI0LTEyLTExIDIwOjU3OjMwIixtb2RpZmllZD0iMjAyNC0x
Mi0xNSAwNDo0OTo0MSJdXQ==
:: animation.lua
--[[pod_format="raw",created="2024-12-15 04:03:37",modified="2024-12-15 04:49:41",revision=63]]

:: button.lua
--[[pod_format="raw",created="2024-12-13 05:48:40",modified="2024-12-15 04:49:41",revision=495]]
-- Create a hoverable button with consistent behavior and optional active state
function create_hover_button(parent, config)
    -- Default configuration
    config = config or {}
    local default_config = {
        x = 0,
        y = 0,
        width = 16,
        height = 16,
        normal_sprite = nil,     -- Sprite shown in normal state
        hover_sprite = nil,      -- Sprite shown when hovered
        active_sprite = nil,     -- Sprite shown when active (if toggle_mode is true)
        active_hover_sprite = nil, -- Sprite shown when active and hovered
        hover_duration = 2,      -- How long hover effect lasts
        toggle_mode = false,     -- Whether the button toggles between states
        onclick = function() end, -- Click handler
        onactivate = function() end,   -- Called when button becomes active
        ondeactivate = function() end  -- Called when button becomes inactive
    }

    -- Merge provided config with defaults
    for k,v in pairs(default_config) do
        if config[k] == nil then
            config[k] = v
        end
    end

    return parent:attach{
        x = config.x,
        y = config.y,
        width = config.width,
        height = config.height,
        hovered = 0,
        active = false,
        
        draw = function(self)
            if self.active then
                if self.hovered > 0 and config.active_hover_sprite then
                    spr(config.active_hover_sprite)
                elseif config.active_sprite then
                    spr(config.active_sprite)
                end
            else
                if self.hovered > 0 and config.hover_sprite then
                    spr(config.hover_sprite)
                elseif config.normal_sprite then
                    spr(config.normal_sprite)
                end
            end
        end,
        
        hover = function(self)
            self.hovered = config.hover_duration
        end,
        
        update = function(self)
            if self.hovered > 0 then
                self.hovered -= 1
            end
        end,
        
        click = function(self)
            if config.toggle_mode then
                self.active = not self.active
                if self.active then
                    config.onactivate(self)
                else
                    config.ondeactivate(self)
                end
            end
            config.onclick(self)
        end,

        -- Helper methods to control state externally
        set_active = function(self, state)
            self.active = state
            if state then
                config.onactivate(self)
            else
                config.ondeactivate(self)
            end
        end
    }
end

-- Helper function to create a button group container
function create_button_group(parent, config)
    return parent:attach{
        x = config.x or 0,
        y = config.y or 0,
        width = config.width or parent.width,
        height = config.height or 16
    }
end
:: gui.lua
--[[pod_format="raw",created="2024-12-11 21:26:33",modified="2024-12-15 04:49:41",revision=1787]]
gui = create_gui()

include("button.lua")

local ui = fetch("./gfx/ui.gfx")
local colors = {
    menu_background = theme"icon0",
    button_unselect = theme"icon1",
    button_select = theme"icon0",
    button_text = theme"icon2",
    container_bg = 5,
}

local menuBar = gui:attach{
    x=320,
    y=0,
    width = 160,
    height = 270,
    draw = function(self)
        rectfill(0,0,self.width,self.height,colors.menu_background)
    end
}

local text_bar = menuBar:attach_text_editor{
    x = 8,
    y = 32,
    width = menuBar.width - 16,
    height = 15,
    block_scrolling = true
}

local controls = create_button_group(menuBar, {
    x = 8,
    y = 8
})

local loadButton = create_hover_button(controls, {
    x = 32,
    normal_sprite = ui[13].bmp,
    hover_sprite = ui[14].bmp,
    onclick = function()
        popup_open = true
    end
})

local saveButton = create_hover_button(controls, {
    x = 64,
    normal_sprite = ui[1].bmp,
    hover_sprite = ui[2].bmp
})

local deleteButton = create_hover_button(controls, {
    x = 96,
    normal_sprite = ui[3].bmp,
    hover_sprite = ui[4].bmp
})

local playback = create_button_group(menuBar, {
    x = 5,
    y = 54
})

local playButton = create_hover_button(playback, {
    x = 48,
    normal_sprite = ui[8].bmp,
    hover_sprite = ui[7].bmp,
    active_sprite = ui[12].bmp,
    active_hover_sprite = ui[11].bmp,
    toggle_mode = true,
    onactivate = function(self)
    	animation_playing = true
    end,
    ondeactivate = function(self)
    	animation_playing = false
    end
})

local loopButton = create_hover_button(playback, {
    x = 96,
    normal_sprite = ui[6].bmp,
    hover_sprite = ui[5].bmp,
    active_sprite = ui[15].bmp,
    active_hover_sprite = ui[16].bmp,
    toggle_mode = true,
    onactivate = function(self)
    	animation_looping = true
    end,
    ondeactivate = function(self)
    	animation_looping = false
    end
})
:: label.png
b64$iVBORw0KGgoAAAANSUhEUgAAAeAAAAEOCAIAAADe_FMwAAAHXklEQVR4Ae3dMWsbVwDA8Sch
gsCD4T6AwWTJ5MVQsEH_DDbuIjJkTMAgNGTv6CWDMBjSbh6Cp1CTpWuJQVnsJZM7lICXLsWQIRC8
uMOVQ0g66WTdSafL78dhzr7n03tP0v-WED4cOBwOh6OERy18OAgL1Nv9usiXm0m3vx6fRGfNjP9y
9_J7aZcDrLr60O-RWXPoWECdkzIWlN2M94_nN9OS890fqIDBbkxtyFBnZs1OxvHZszY6MuN84jFT
R-Z2v8bH0HmaRpYXvnvxPXue0gYvRbe-Pnn9QL51HozA3YvvceDyysJgc2a65_Dg7A_Ame6f4zJT
Az20jPhVs6x5noYmP_OYjj1PUhv-JRkw9m5pl5I7qDaQ7wNjnudH1kAnLxDfffKjZuzVWac1GN_x
GU0GDP4lrbODl0bTP-8T0icSFlC67N-KMkx_aBoT1jKUpuQ8a6AHSzR18QXtzuQZZ--fofQne-GI
WMcr1Wgoom6DX6vs37JkWPYQTb1z0cWP4zOUoAmZrqetITprJseE1Y4euawhPoZWNVjhwfIOPZ3S
_ptcfcQDINkTXydYIbNGaWzTCv3ip-Uq1pj8NFvM0yaJ5lBA06Y_2uvkufSI_Ob17AXigERnzTgO
8bdmciiGvlmFftEyJmtwWJb5FDfnWvhwsLA3b-KzIqMkx0Xo9tdn3eu8nlJA5Y22Kw5at78_dnyj
AisEWAljQ5xW5xBCLRwf2DWopOiqaRNWWt0WAJRTwxYAhfr14e-k-GXt6Uz-u3Zzn2XYt2dPZp3V
3fvzmcZHh22BBipb5-jXWRv9sP1-GWvX5_-evo7Pn796E0J49-b181dvHrbba9fnj2j0x8tPGUfu
tXaWsnsCDeQT4p9-_5pl5MuX_b-6oxtdcnUfLCAX--7yV-gjw1GMh_322s19xba04VMFrJx3b1-P
f5O91o5AA_Tj_as3ed0qOmzfvT--ePkp-rW1tXn5_Utax6PDtkADpHrYXk4ll6juXQcIIey1doZO
BBpgutr1_YTjcfeMDttTW7zX2okO28tadcMbD6yE2-7p2L9v7B5Vdcl17zqAQAPMa2P3KDkqv9iG
9xtYIbf903xvuNfa_Xj5Ke1SdNhe4mLr3m9ghWzsHiXH-Hdbbn_nani-gVz8_c9P4fcM42pzvcpt
-7Sg_X_8-DR0ItBAFbysPS3ozrXr8-hkY-do6phHiA7be62dtEvL3dVaOD7w2YJKiq6aNmGl1W0B
QDk1bAH8INZu7m1CyX179mTw17odASgngQYQaAAEGkCgARBoAIEGQKABEGgAgQZAoAEEGgCBBkCg
AUqtFo4P7AJUUnTVtAkrrW4LAAQaAIEGEGgACtKwBUChLrqd5Hy-d7L0OQxZ1pQEGiiF1tbmYCgX
3MSLbieZwNirpW20QAOLLvUiMz25zvGUSttogQaqnOn93snURpeWQAMVz3Tc6LQJCDTA0jJ90e2M
3nlsssum7vMBlCHTra3NIqJ50e0UdGeBBn6sTOdb0rjOo3dO-l7Q6wo0QKY6j1Z4v3dy_flLcuny
85f93olAA6TKN5STK5xcLW2dQwgNnwmgDGmOo7nIF93vnVx0O6Wts0ADP1CaL7qd0UaXeXMEGqh_
mkMIra3Nsckuc6MFGqh4midXu8yNFmigsmne751cdDutrc0J8yltnUMItXB84EMDlRRdNcswjYtu
Z7CYy53AaMHL-A4KNAg0JVW3BQACDYBAAwg0AAININAACDQAAg0g0AAINIBAAyDQAAg0gEADINAA
Ag2AQAMINAACDYBAAwg0AAININAACDQAAg0g0AAINIBAAyDQAAINgEADINAAAg2AQAMINAACDYBA
Awg0AAININAACDSAQAMg0AAINIBAAyDQAAINgEADINAAAg2AQAMINPADWru5twkCDZSxzrf9U40W
aKCkNFqgAY1GoAGNXhENWwBMtrF7FEL49uyJrViwWjg_sAtQSdFVc847rN3chxBu_6cbu0cCLdBA
iQLNctVtAYBAAyDQAAINgEADCDQAAg2AQAMINAACDSDQAAg0AAININAACDSAQAMg0AACDYBAAyDQ
AAINgEADCDQAAg2AQAMINAACDSDQAAg0gEADINAACDSAQAMg0AACDYBAAyDQAAINgEADCDQAAg0g
0AAINAACDSDQAAg0gEADINAACDSAQAMg0AACDYBAAyDQAAINgEADCDQAAg0g0AAINAACDSDQAAg0
gEADINAACDSAQAMg0AACDYBAAwg0AAINgEADCDQAAg0g0AAINAACDSDQAAg0gEADINAAAg2AQAMg
0AACDYBAAwg0AAINgEADCDQAAg0g0AAINAACDSDQAAg0gEADINAAAg2AQAMg0AACDYBAAwg0AAIN
gEADCDQAAg0g0AAINIBAAyDQAAg0gEADINAAAg2AQAMg0AACDYBAAwg0AAININAACDQAAg0g0AAI
NIBAAyDQAAg0gEADINAAAg2AQAMg0AACDYBAAwg0AAININAACDQAAg2wev4D6kxi5-vMUHcAAAAQ
dEVYdExvZGVQTkcAMjAxMTAyMjHjWbbBAAAAAElFTkSuQmCC
:: main.lua
--[[pod_format="raw",author="Arranged Godly",created="2024-12-11 20:55:39",modified="2024-12-15 04:49:41",notes="A tool for creating afx\nanimation files from gfx files",revision=1696,title="Animation Editor",version="0.1"]]
include "gui.lua"
include "popup.lua"

popup_open = false

function _init()
  get_display()
  window({
    width = 480,
    height = 270,
    title = "temp.afx",
    has_frame = false,
    show_toolbar = true,
    tabbed = true,
    icon = userdata("[gfx]08087770777077707770777077700700070077777707777777777777777777777707[/gfx]"),
    x = 0,
    y = 0
  })
  
  mkdir("/ram/cart/afx")
  
end

function _update()
	gui:update_all()
	
	if popup_open then popup_gui:update_all() end
	
	if key("escape") then
		stop()
	end
end

function _draw()
	cls(theme"window_frame")
	gui:draw_all()
	
	if popup_open then popup_gui:draw_all() end
  
end
:: popup.lua
--[[pod_format="raw",created="2024-12-12 17:19:03",modified="2024-12-15 04:49:41",revision=1254]]
popup_gui = create_gui()
local ui = fetch("./gfx/ui.gfx")
settings = {
	height = 8,
	width = 8
}
frame = 1

local frame_state = {
	selected_frames = {},
	
	add_frame = function(self, sprite_num)
		table.insert(self.selected_frames, sprite_num)
		return #self.selected_frames
	end,
	
	remove_frame = function(self, sprite_num)
		for i, frame in ipairs(self.selected_frames) do
			if frame == sprite_num then
				table.remove(self.selected_frames, i)
				return true
			end
		end
		return false
	end,
	
	get_frame_number = function(self, sprite_num)
		for i, frame in ipairs(self.selected_frames) do
			if frame == sprite_num then
				return i
			end
		end
		return 0
	end,
	
	reset = function(self)
		self.selected_frames = {}
	end
}

local Window = popup_gui:attach{
	x = 32,
	y = 5,
	width = 256,
	height = 250,
	draw = function(self)
		fillBG(self,6)
	end
}

local closeButton = popup_gui:attach{
	x = 300,
	y = 2,
	width = 16,
	height = 16,
	hovered = 0,
	draw = function(self)
		if self.hovered > 0 then
			spr(ui[17].bmp)
		else
			spr(ui[18].bmp)
		end
	end,
	hover = function(self)
		self.hovered = 2
	end,
	click = function(self)
		popup_open = false
		reset_popup()
	end,
	update = function(self)
		if self.hovered > 0 then
			self.hovered -= 1
		end
	end
}

local confirmButton = popup_gui:attach{
	x = 300,
	y = 40,
	width = 16,
	height = 16,
	hovered = 0,
	draw = function(self)
		if self.hovered > 0 then
			spr(ui[20].bmp)
		else
			spr(ui[19].bmp)
		end
	end,
	hover = function(self)
		self.hovered = 2
	end,
	click = function(self)
		popup_open = false
		reset_popup()
	end,
	update = function(self)
		if self.hovered > 0 then
			self.hovered -= 1
		end
	end
}

for h = 0, settings.height - 1 do
	for w = 0, settings.width - 1 do
		Window:attach{
			x = w * 32,
			y = h * 32,
			width = 32,
			height = 32,
			sprite_num = frame,
			hovered = 0,
			draw = function(self)
				rectfill(0, 0, self.width, self.height, 0)
				sspr(self.sprite_num, 0, 0, 16, 16, 0, 0, 32, 32)
				
				local frame_num = frame_state:get_frame_number(self.sprite_num)
				if frame_num > 0 then
					rect(0, 0, self.width-1, self.height-1, 7)
					print(frame_num, 2, 2, 7)
				end
			end,
			hover = function(self)
				self.hovered = 2
			end,
			click = function(self)
				local current_num = frame_state:get_frame_number(self.sprite_num)
				if current_num > 0 then
					frame_state:remove_frame(self.sprite_num)
				else
					frame_state:add_frame(self.sprite_num)
				end
			end,
			update = function(self)
				if self.hovered > 0 then
					self.hovered -= 1
				end
			end
		}
		frame += 1
	end
end

function fillBG(self, col)
	rectfill(0,0,self.width,self.height,col)
end

function reset_popup()
	frame_state:reset()
	frame = 1
end
:: .info.pod
b64$LS1bW3BvZCxhdXRob3I9IkFycmFuZ2VkIEdvZGx5IixjcmVhdGVkPSIyMDI0LTEyLTExIDIw
OjU2OjIzIixpY29uPXVzZXJkYXRhKCJ1OCIsMTYsMTYsIjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwNzA3MDcwNzA3MDAwMDAwMDAwMDAwMDcwNzA3MDAwMDA3
MDEwMTAxMDcwMDAwMDAwMDAwMDAwNzAxMDcwMDAwMDcwMTAxMDEwNzAwMDAwMDAwMDAwMDA3MDcw
NzAwMDAwNzA3MDcwNzA3MDAwMDAwMDAwMDAwMGQwNzBkMDAwMDBkMGQwNzBkMGQwMDAwMDAwMDAw
MDcwNzA3MDcwNzA3MDcwNzA3MDcwNzAwMDAwNzAwMDAwNzA3MDcwNzA3MDcwNzA3MDcwNzA3MDAw
NzA2MDAwMDA3MDcwNzAxMDEwMTA3MDEwMTAxMDcwNzA2MDYwMDAwMDcwNzA3MDEwNzAxMDcwMTA3
MDcwNzA3MDYwNjAwMDAwNzA3MDcwMTAxMDEwNzAxMDEwNzA3MDcwNjA2MDAwMDA3MDcwNzAxMDcw
MTA3MDEwNzA3MDcwNzA2MDYwMDAwMGQwNzA3MDEwNzAxMDcwMTAxMDEwNzA3MDYwNjAwMDAwMDBk
MDcwNzA3MDcwNzA3MDcwNzA3MGQwNzA2MDAwMDAwMDAwZDA3MDcwNzA3MDcwNzA3MDcwMDBkMDcw
MDAwMDAwMDAwMGQwZDBkMGQwZDBkMGQwZDAwMDAwZDAwIiksbW9kaWZpZWQ9IjIwMjQtMTItMTUg
MDQ6NDk6NDEiLG5vdGVzPSJBIHRvb2wgZm9yIGNvbnZlcnRpbmcgZ2Z4XG5maWxlcyBpbnRvIGFm
eCBhbmltYXRpb25zIixydW50aW1lPTEyLHRpdGxlPSJBbmltYXRpb24gRWRpdG9yIix2ZXJzaW9u
PSIwLjEiLHdvcmtzcGFjZXM9e3tsb2NhdGlvbj0ibWFpbi5sdWEjMSIsd29ya3NwYWNlX2luZGV4
PTF9LHtsb2NhdGlvbj0iZ3VpLmx1YSMyOSIsd29ya3NwYWNlX2luZGV4PTF9LHtsb2NhdGlvbj0i
cG9wdXAubHVhIzYiLHdvcmtzcGFjZV9pbmRleD0xfSx7bG9jYXRpb249ImJ1dHRvbi5sdWEjMTEi
LHdvcmtzcGFjZV9pbmRleD0xfSx7bG9jYXRpb249ImFuaW1hdGlvbi5sdWEjMSIsd29ya3NwYWNl
X2luZGV4PTF9LHtsb2NhdGlvbj0iZ2Z4LzAuZ2Z4Iix3b3Jrc3BhY2VfaW5kZXg9Mn0se2xvY2F0
aW9uPSJnZngvdWkuZ2Z4Iix3b3Jrc3BhY2VfaW5kZXg9Mn0se2xvY2F0aW9uPSJtYXAvMC5tYXAi
LHdvcmtzcGFjZV9pbmRleD0zfSx7bG9jYXRpb249InNmeC8wLnNmeCIsd29ya3NwYWNlX2luZGV4
PTR9fV1d
:: [eoc]
